## 数学公式解説Webアプリ 技術ドキュメント
created by: gemini-2.0-flush

このドキュメントは、数学公式解説Webアプリの技術仕様を説明します。新規参加者や既存ユーザーがプロジェクトに容易に貢献できるように、詳細な情報と具体的な例を提示します。


**I. 一般項目**

**1. プロジェクト概要**

本プロジェクトは、Gemini AIを用いて生成された数学公式の解説をWebアプリとして提供するものです。講義形式と漫才形式の2種類の解説を提供することで、ユーザーが自身の学習スタイルに合った方法で数学を理解できるよう支援します。具体的な課題解決方法は、多様な学習スタイルへの対応と、AIによる効率的なコンテンツ生成にあります。


**2. まず利用するために (Getting Started)**

本アプリはWebブラウザで利用可能です。以下のURLにアクセスしてください。

[アプリURL:  (ここに実際のURLを入力)]


**3. ファイル構造図とディレクトリ説明**

```
math-web/
├── common/             # 共通コンポーネントとユーティリティ
│   ├── breadcrumb.tsx  # パンくずリストコンポーネント
│   ├── contents.tsx   # コンテンツデータの型定義とユーティリティ関数
│   ├── read.tsx       # コンテンツJSONファイル読み込み関数
│   └── url.tsx        # ベースURL取得関数
├── features/           # アプリケーションの機能コンポーネント
│   ├── article.tsx    # 記事表示コンポーネント
│   └── search.tsx     # 検索機能コンポーネント
├── next.config.ts      # Next.jsの設定ファイル
├── README.md           # プロジェクトの概要説明
├── src/                # アプリケーションコード
│   ├── app/            # Next.jsアプリケーションのルート
│   │   ├── about/page.tsx # Aboutページ
│   │   ├── api/contents/route.tsx # APIエンドポイント(コンテンツ取得)
│   │   ├── article.module.css # ArticleコンポーネントのCSS
│   │   ├── globals.css # グローバルCSS
│   │   ├── layout.tsx  # レイアウトコンポーネント
│   │   ├── page.module.css # トップページのCSS
│   │   ├── page.tsx     # トップページ
│   │   ├── poricy/page.tsx # ポリシーページ
│   │   └── sitemap.tsx # サイトマップ生成
│   └── data/            # 静的データ
│       └── contents.json # コンテンツデータ (JSONファイル)
└── package.json        # プロジェクトの依存関係
```

* **common/**: アプリケーション全体で共通して使用するコンポーネントや関数などを格納しています。
* **features/**: 各機能（記事表示、検索など）をカプセル化したコンポーネントを格納しています。
* **src/app/**: Next.jsアプリケーションのページとAPIエンドポイントを定義するディレクトリです。  ファイルパスはURL構造と対応しています。
* **src/data/**: 静的なコンテンツデータ（JSONファイル）を格納しています。


**4. 各ファイル・モジュールの詳細**

* **common/breadcrumb.tsx**: パンくずリストを表示するコンポーネントです。`next/navigation` を使用し、現在のパスに基づいてパンくずリストを動的に生成します。`antd` の `Breadcrumb` コンポーネントを使用しています。`replaceWords` 関数は、URLスラッグを日本語に変換します。

* **common/contents.tsx**: アプリケーションで使用するコンテンツデータの型定義 (`Content`, `Pair`) と、スラッグからラベルへの変換関数 (`switch_slug_to_label`) を定義しています。

* **common/read.tsx**:  `src/data/contents.json` からコンテンツデータを読み込む非同期関数です。ファイルが存在しない場合はエラーをスローします。

* **common/url.tsx**: アプリケーションのベースURLを取得する関数です。開発環境と本番環境（Vercel）でURLを区別します。

* **features/article.tsx**:  `Content` データを受け取り、記事コンテンツを表示するコンポーネントです。`ReactMarkdown` を使用してMarkdownをレンダリングし、`remark-math` と `rehype-mathjax` で数式を処理します。`antd` の `Tabs` コンポーネントを使用して、講義形式と漫才形式を切り替えることができます。動画表示機能(Youtube埋め込み)も備え、ランダム表示機能も実装しています。

* **features/search.tsx**:  コンテンツを検索するコンポーネントです。`antd` の `Input` コンポーネントを使用し、検索クエリを入力できます。`lodash/debounce` を使用して、検索クエリ入力からの遅延を制御します。

* **next.config.ts**: Next.js の設定ファイルです。現在は空です。

* **README.md**: プロジェクトの概要説明です。

* **src/app/***:  Next.jsのファイルパスとURLパスが対応しています。各ファイルはそれぞれのページ/APIエンドポイントに対応しています。


**II. 技術項目**

**5. 設計アルゴリズムやパターン**

* **ファイル構造**:  Next.jsのファイルシステムルーティングを採用しています。ファイルパスがURLパスに対応することで、シンプルで分かりやすい構造を実現しています。
* **データ管理**: 静的なJSONファイルにコンテンツデータを格納し、`read.tsx` で読み込んでいます。
* **検索アルゴリズム**:  単純な文字列包含検索を使用しています。高速性を優先し、複雑な検索アルゴリズムは実装していません。将来的な拡張として、より高度な検索機能の実装を検討できます。
* **エラー処理**:  `read.tsx` では、ファイル読み込みエラーを適切に処理しています。`generateMetadata`ではコンテンツがない場合のエラー処理を実装しています。
* **コンポーネント設計**:  機能ごとにコンポーネントを分割することで、再利用性と保守性を高めています。

**6. 環境構築・セットアップ手順**

1. **Node.jsとnpmのインストール**: 最新版のNode.jsとnpmをインストールします。
2. **プロジェクトのクローン**:  GitHubからプロジェクトをクローンします。
   ```bash
   git clone [GitHubリポジトリURL]
   ```
3. **依存関係のインストール**: プロジェクトディレクトリに移動し、依存関係をインストールします。
   ```bash
   cd math-web
   npm install
   ```
4. **開発サーバーの起動**: 開発サーバーを起動します。
   ```bash
   npm run dev
   ```
5. **本番環境へのデプロイ**: Vercelなどのホスティングサービスを使用してデプロイします。


**発生しやすいエラーと解決策**:

* **`contents.json`が見つからない**:  `src/data/contents.json` が存在することを確認してください。
* **依存関係のインストールエラー**: npmのバージョンが古いか、ネットワーク接続の問題が考えられます。npmを更新するか、接続状況を確認してください。
* **MathJaxのレンダリングエラー**: MathJaxが正しく設定されているか確認してください。 `rehype-mathjax` の設定を確認し、必要であればMathJax CDNの設定を確認してください。


**7. ベストプラクティスと拡張方法**

* **コードの整理**:  コードの可読性を高めるために、コメントや適切な命名規則を使用してください。
* **テストの追加**:  ユニットテストやE2Eテストを追加することで、コードの品質を向上させることができます。
* **パフォーマンスの最適化**:  コンテンツの量が増加した場合、パフォーマンスの最適化が必要です。データのキャッシングや効率的な検索アルゴリズムの採用を検討してください。
* **検索機能の拡張**:  全文検索エンジン(Elasticsearchなど)の導入を検討することで、より高度な検索機能を実現できます。
* **国際化対応**:  多言語対応を検討し、より幅広いユーザーに利用できるよう拡張できます。


**新規参加者や利用者向けの追記**

* **`antd`**: UIコンポーネントを提供するライブラリです。レイアウトやUI部品の構成に利用されています。
* **`next/navigation`**: Next.jsのナビゲーションライブラリです。クライアントサイドでのルーティングに利用されています。
* **`remark-math`, `rehype-mathjax`**:  MathJaxを用いた数式レンダリングのためのライブラリです。数式を含むコンテンツを正しく表示するために必要です。
* **`react-markdown`**: Markdown形式のテキストをレンダリングするためのライブラリです。
* **`lodash/debounce`**:  イベントハンドラの処理を一定時間遅延させるためのユーティリティ関数です。検索機能における入力遅延制御に使用されています。


このライブラリやモジュールは、それぞれの機能において適切なタイミングで使用されます。例えば、`antd` はUIコンポーネントを提供し、`remark-math` と `rehype-mathjax` は数式レンダリングを行い、`next/navigation` はページ遷移を管理します。`lodash/debounce`はユーザーの入力イベントを監視し、必要に応じて検索処理を実行します。


このドキュメントが、プロジェクトへの貢献を始める際に役立つことを願っています。


